/**
 *
 * PetJS - This library is designed to develop (full) ajax application
 *
 * @author     Yaroslav Peteychuk <http://www.peteychuk.com/>, <peteychuk@gmail.com>
 * @url        http://petframework.peteychuk.com/
 * @copyright  2012-2013 by Peteychuk
 * @version    1.0.0
 * @update     14-12-2013
 * @includes   HistoryAPI 4.0.2 (c) 2011-2013 by Dmitrii Pakhtinov
 *
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */


/**
 * HistoryAPI for HTML4 browsers
 */
(function(window,True,False,Null,undefined){"use strict";var document=window.document,windowHistory=window.history||{},windowLocation=window.location,api=!!windowHistory.pushState,initialState=api&&windowHistory.state===undefined,initialFire=windowLocation.href,JSON=window.JSON||{},defineProp=Object.defineProperty,defineGetter=Object.prototype.__defineGetter__,defineSetter=Object.prototype.__defineSetter__,historyPushState=windowHistory.pushState,historyReplaceState=windowHistory.replaceState,sessionStorage=window.sessionStorage,hasOwnProperty=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,msie=+((eval("/*@cc_on 1;@*/")&&/msie (\d+)/i.exec(navigator.userAgent)||[])[1]||0),libID=(new Date).getTime(),VBInc=(defineProp||defineGetter)&&(!msie||msie>8)?0:1,iframe=msie<8?document.createElement("iframe"):False,_a,_r,_d,eventPrefix="",addEvent=(_a="addEventListener",window[_a])||(_a="attachEvent",eventPrefix="on",window[_a]),removeEvent=(_r="removeEventListener",window[_r])||(_r="detachEvent",window[_r]),fireEvent=(_d="dispatchEvent",window[_d])||(_d="fireEvent",window[_d]),eventsListPopState=[],eventsListHashChange=[],skipHashChange=0,eventsList={onpopstate:eventsListPopState,popstate:eventsListPopState,onhashchange:eventsListHashChange,hashchange:eventsListHashChange},sets=function(){var e,t,n,r={basepath:"/",redirect:0,type:"/"},i=document.getElementsByTagName("SCRIPT");for(e=0;i[e];e++){if(t=/(.*)\/(?:history|spike)(?:-\d\.\d(?:\.\d)?\w?)?(?:\.min)?.js\?(.*)$/i.exec(i[e].src)||e===i.length-1&&(t=i[e].src.split("?")).length===2&&(t[2]=t[1])&&t){for(e=0,n=t[2].split("&");n[e];){t=n[e++].split("=");r[t[0]]=t[1]=="true"?True:t[1]=="false"?False:t[1]||""}r["basepath"]=r["basepath"]||"/";break}}return r}(),normalizeUrl=function(e){var t,n,r,i,s,o,u,a=new RegExp("^"+sets["basepath"],"i");return function(f,l){if(!f){f=windowLocation.href;if(!api||l){f=windowLocation.protocol+"//"+windowLocation.host+sets["basepath"]+(f.replace(/^[^#]*/,"")||"#").replace(new RegExp("^#[/]?(?:"+sets["type"]+")?"),"")}}else if(!api){var c=normalizeUrl(),h=c._pathname,p=c._protocol;f=/^(?:[a-z]+\:)?\/\//.test(f)?f.indexOf("/")===0?p+f:f:p+"//"+c._host+(f.indexOf("/")===0?f:f.indexOf("?")===0?h+f:f.indexOf("#")===0?h+c._search+f:h.replace(/[^\/]+$/g,"")+f)}if(t!==f){e.href=t=f;o=e.port;s=e.host;u=e.pathname;if(e.protocol==="http:"&&o==80||e.protocol==="https:"&&o==443){s=e.hostname;o=""}u=u.indexOf("/")===0?u:"/"+u;n=u+e.search+e.hash;i=u.replace(a,sets["type"])+e.search;r=i+e.hash}return{_href:e.protocol+"//"+s+n,_protocol:e.protocol,_host:s,_hostname:e.hostname||windowLocation.hostname,_port:o||windowLocation.port,_pathname:u,_search:e.search,_hash:e.hash,_relative:n,_nohash:i,_special:r}}}(document.createElement("a")),History=!VBInc?windowHistory:{back:windowHistory.back,forward:windowHistory.forward,go:windowHistory.go,pushState:Null,replaceState:Null,emulate:!api,toString:function(){return"[object History]"}},HistoryAccessors={state:{get:function(){return iframe&&iframe["storage"]||historyStorage()[History.location.href]||Null}},length:{get:function(){return windowHistory.length}},location:{set:function(e){window.location=e},get:function(){return api?windowLocation:Location}}},Location={assign:function(e){windowLocation.assign(api||e.indexOf("#")!==0?e:"#"+normalizeUrl()._nohash+e)},reload:windowLocation.reload,replace:function(e){windowLocation.replace(api||e.indexOf("#")!==0?e:"#"+normalizeUrl()._nohash+e)},toString:function(){return this.href}},LocationAccessors={href:{set:function(e){windowLocation.href=e},get:function(){return normalizeUrl()._href}},protocol:{set:function(e){windowLocation.protocol=e},get:function(){return windowLocation.protocol}},host:{set:function(e){windowLocation.host=e},get:function(){return windowLocation.host}},hostname:{set:function(e){windowLocation.hostname=e},get:function(){return windowLocation.hostname}},port:{set:function(e){windowLocation.port=e},get:function(){return windowLocation.port}},pathname:{set:function(e){windowLocation.pathname=e},get:function(){return normalizeUrl()._pathname}},search:{set:function(e){windowLocation.search=e},get:function(){return normalizeUrl()._search}},hash:{set:function(e){var t=e.indexOf("#")===0?e:"#"+e,n=normalizeUrl();if(iframe){if(t!=n._hash){History.pushState(Null,Null,n._nohash+t);hashChanged({oldURL:n._href})}}else{windowLocation.hash="#"+n._nohash+t}},get:function(){return normalizeUrl()._hash}}},createStaticObject=function(e,t,n){var r=e,i,s=False;if(defineProp||defineGetter){for(i in t){if(hasOwnProperty.call(t,i)){if(defineGetter){t[i].get&&defineGetter.call(e,i,t[i].get);t[i].set&&defineSetter.call(e,i,t[i].set)}else if(defineProp){try{defineProp(e,i,t[i])}catch(o){if(n){return False}s=True;break}}}}}else s=True;if(s&&VBInc){var u="StaticClass"+libID+VBInc++,a=["Class "+u];if(!("execVB"in window)){execScript("Function execVB(c) ExecuteGlobal(c) End Function","VBScript")}if(!("VBCVal"in window)){execScript("Function VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function","VBScript")}for(i in e){a[a.length]="Public ["+i+"]"}if(hasOwnProperty.call(e,"toString")){if(!e.propertyIsEnumerable("toString")){a[a.length]="Public [toString]"}t["(toString)"]={get:function(){return this.toString.call(this)}}}for(i in t){if(hasOwnProperty.call(t,i)){if(t[i].get){e["get "+i]=t[i].get;a.push("Public [get "+i+"]","Public "+(i==="(toString)"?"Default ":"")+"Property Get ["+i+"]","Call VBCVal(me.[get "+i+"].call(me),["+i+"])","End Property")}if(t[i].set){e["set "+i]=t[i].set;a.push("Public [set "+i+"]","Public Property Let ["+i+"](v)","Call me.[set "+i+"].call(me,v)","End Property","Public Property Set ["+i+"](v)","Call me.[set "+i+"].call(me,v)","End Property")}}}a.push("End Class","Function "+u+"Factory()","Set "+u+"Factory=New "+u,"End Function");execVB(a.join("\n"));r=window[u+"Factory"]();for(i in e){r[i]=e[i]}if(hasOwnProperty.call(e,"toString")){r.toString=e.toString}}return r},JSONStringify=JSON.stringify||function(e){function t(e){var t=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.lastIndex=0;return t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}var n=function(r){var i,s,o,u=(typeof r).charCodeAt(2);return u===114?t(r):u===109?isFinite(r)?String(r):"null":u===111||u===108?String(r):u===106?function(){if(!r)return"null";i=toString.apply(r)==="[object Array]";s=i?"[":"{";if(i){for(o=0;o<r.length;o++){s+=(o==0?"":",")+n(r[o])}}else{for(o in r){if(hasOwnProperty.call(r,o)&&r[o]!==e){s+=(s.length==1?"":",")+t(o)+":"+n(r[o])}}}return s+(i?"]":"}")}():e};return n}(),JSONParse=function(){var e=JSON.parse;return function(t){return t?e?e(t):(new Function("return "+t))():Null}}(),historyStorage=function(e){return sessionStorage?e?sessionStorage.setItem("__hitoryapi__",JSONStringify(e)):JSONParse(sessionStorage.getItem("__hitoryapi__"))||{}:{}},fireStateChange=function(e,t,n){var r=e===2?window.onhashchange:window.onpopstate,i=e===2?"hashchange":"popstate",s,o=eventsList[i];if(document.createEvent){s=document.createEvent("Events");s.initEvent(i,False,False)}else{s=document.createEventObject();s.type=i}s.state=History.state;s.oldURL=t;s.newURL=n;if(r){r.call(window,s)}for(var u=0,a=o.length;u<a;u++){o[u].call(window,s)}},hashChanged=function(){var e=window.onpopstate||Null,t=window.onhashchange||Null,n=0,r=Null,i=normalizeUrl(),s=i._href,o=i._hash.replace(/^#/,""),u=function(){if(initialFire&&!(initialFire=0)&&i._relative!==sets["basepath"]){clearInterval(r);setTimeout(fireStateChange,10)}},a=function(e){var t=normalizeUrl();if(skipHashChange){s=t._href;return skipHashChange=0}var r=e.oldURL||s,i=s=e.newURL||t._href,o=r.replace(/^.*?(#|$)/,""),u=i.replace(/^.*?(#|$)/,"");if(r!=i&&!n){fireStateChange()}n=0;initialFire=0;if(o!=u){fireStateChange(2,r,i)}};addEvent(eventPrefix+"hashchange",a,False);addEvent(eventPrefix+"popstate",function(){if(initialFire===windowLocation.href){return initialFire=0}initialFire=0;fireStateChange(n=1)},False);History["fixURL"]=function(e){return normalizeUrl(e)._relative};History=createStaticObject(History,VBInc?HistoryAccessors:windowHistory.state===undefined?{state:HistoryAccessors.state,location:HistoryAccessors.location}:{location:HistoryAccessors.location});Location=createStaticObject(Location,LocationAccessors);window[_a]=function(e,t,n,r){if(eventsList[e]){eventsList[e].push(t);if(!api&&eventsListPopState===eventsList[e]){u()}}else{addEvent(e,t,n,r)}};window[_r]=function(e,t,n){var r=eventsList[e];if(r){for(var i=r.length;--i;){if(r[i]===t){r.splice(i,1);break}}}else{removeEvent(e,t,n)}};window[_d]=function(e,t){var n=e&&e.type||e,r=eventsList[e],i=r===eventsListPopState?window.onpopstate:window.onhashchange;if(r){t=t||(typeof e=="string"?window.event:e);try{t&&(t.target=window)}catch(s){try{t.srcElement=window}catch(s){}}if(i){i.call(window,t)}for(var o=0,u=r.length;o<u;o++){r[o].call(window,t)}return True}else{return fireEvent(e,t)}};if(VBInc){execScript("Public history, onhashchange","VBScript")}if((!defineProp&&!defineGetter||!createStaticObject(window,{onhashchange:{get:function(){return t},set:function(e){t=e||Null}},onpopstate:{get:function(){return e},set:function(t){if(e=t||Null){!api&&u()}}}},1))&&!api){r=setInterval(function(){if(window.onpopstate){u()}},100)}if(sets["redirect"]&&window.top==window.self){var f=normalizeUrl(Null,True)._relative,l=windowLocation.search,c=windowLocation.pathname,h=sets["basepath"];if(api){if(f!=h&&(new RegExp("^"+h+"$","i")).test(c)){windowLocation.href=f}if(!(new RegExp("^"+h,"i")).test(c)){windowLocation.href=c.replace(/^\//,h)+l}}else if(c!=h){windowLocation.href=h+"#"+c.replace(new RegExp("^"+h,"i"),sets["type"])+l+windowLocation.hash}}return a}();History.pushState=function(e,t,n,r){var i=historyStorage(),s=normalizeUrl()._href,o=n&&normalizeUrl(n);initialFire=0;n=o?o._href:s;if(r&&i[s]){delete i[s]}if((!api||initialState)&&sessionStorage&&e){i[n]=e;historyStorage(i);e=Null}if(historyPushState&&historyReplaceState){if(r){historyReplaceState.call(History,e,t,n)}else{historyPushState.call(History,e,t,n)}}else if(o&&o._relative!=normalizeUrl()._relative){skipHashChange=1;if(r){windowLocation.replace("#"+o._special)}else{windowLocation.hash=o._special}}};History.replaceState=function(e,t,n){History.pushState(e,t,n,1)};if(VBInc){window.history=History;(function(e,t){if(!iframe)return;var n,r,i=function(){var e=normalizeUrl()._href;if(t!=e){hashChanged({oldURL:t,newURL:t=e})}};r=setInterval(i,100);iframe.src="javascript:true;";iframe=document.documentElement.firstChild.appendChild(iframe).contentWindow;History.pushState=n=function(e,s,o,u,a){var f=iframe.document,l=["<script>","lfirst=1;",,"storage="+JSONStringify(e)+";","</script>"],c=o&&normalizeUrl(o);if(!c){iframe["storage"]=e;return}if(!a){clearInterval(r)}if(u){if(iframe["lfirst"]){history.back();n(e,s,c._href,0,1)}else{iframe["storage"]=e;windowLocation.replace("#"+c._special)}}else if(c._href!=t||a){if(!iframe["lfirst"]){iframe["lfirst"]=1;n(iframe["storage"],s,t,0,1)}l[2]='parent.location.hash="'+c._special.replace(/"/g,'\\"')+'";';f.open();f.write(l.join(""));f.close()}if(!a){t=normalizeUrl()._href;r=setInterval(i,100)}};addEvent(eventPrefix+"unload",function(){if(iframe["storage"]){var e={};e[normalizeUrl()._href]=iframe["storage"];document.cookie="_historyAPI="+escape(JSONStringify(e))}clearInterval(r)},False);if(e.length>1){e=unescape(e.pop().split(";").shift());try{iframe["storage"]=JSONParse(e)[normalizeUrl()._href]}catch(s){}}if(!JSON.parse&&!JSON.stringify){JSON.parse=JSONParse;JSON.stringify=JSONStringify;window.JSON=JSON}})(document.cookie.split("_historyAPI="),normalizeUrl()._href)}else{window.history["emulate"]=!api}})(window,true,false,null);


/**
 * PetJS
 */
(function(e,t){"use strict";var n=e.pet=function(){var t={};var r={};var i=r;r.options={debug:false,basePath:"/",collection404:false};r.data={lastQuery:{},breakRequest:{lastLocation:"",breakTo:false},withControlPanel:true};t.setSettings=function(e){n.extend(r.options,e);return true};t.getSettings=function(e){return i.options[e]};r.collection={};r.ready={options:{loaded:false,readyList:[]},init:function(){var t=false;var n=function(){if(t)return;t=true;i.ready.loaded()};if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){n()},false)}else if(document.attachEvent){if(document.documentElement.doScroll&&e==e.top){var r=function(){if(t)return;if(!document.body)return;try{document.documentElement.doScroll("left");n()}catch(e){setTimeout(r,0)}};r()}document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){n()}})}if(e.addEventListener)e.addEventListener("load",n,false);else if(e.attachEvent)e.attachEvent("onload",n)},loaded:function(){if(history.emulate===true){if(e.location.pathname!=n.getSettings("basePath")){e.location.href=n.getSettings("basePath")+"#"+e.location.pathname;return}}i.setSettings();var t;n.ready(function(){i.nav.init()});i.ready.options.loaded=true;for(var r=0;r<i.ready.options.readyList.length;r++){t=i.ready.options.readyList[r];t()}}};t.ready=function(e){if(typeof e==="function"){if(i.ready.options.loaded){return e()}else{i.ready.options.readyList.push(e);return true}}return};r.nav={init:function(){i.router.ready();e.onpopstate=function(e){var t=history.location.pathname||document.location.pathname;i.data.withControlPanel=true;i.router.search(t,false);return false}},setLoc:function(e,t){history.pushState(null,t,e)}};t.nav={go:function(t,n){if(typeof n!=="undefined"&&typeof n.which!=="undefined"&&n.which===2)return true;var r;if(typeof t==="object")r=t.href;else if(typeof t==="string")r=t;else return;var s=new RegExp("^(https?://"+e.location.host.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")+")","i");r=r.replace(s,"");if(r.search(/https?\:\/\//i)===0){location.href=r;return false}i.data.withControlPanel=false;i.router.search(r,true);return false},withControlPanel:function(){return i.data.withControlPanel?true:false}};r.router={options:{},search:function(e,t){i.data.breakRequest.lastLocation=n.router.getLocation();if(i.data.lastQuery.finish===false){i.data.lastQuery.aborted=true;i.data.lastQuery.finish=true;i.data.lastQuery.abort();if(typeof i.data.lastQuery.abortOption==="function")i.data.lastQuery.abortOption();if(i.data.breakRequest.breakTo!==false){var r=i.getControl(i.data.breakRequest.breakTo);i.router.options.loc=i.data.breakRequest.breakTo;i.router.options.collection=r.collection;i.router.options.param=r.param;i.data.breakRequest.lastLocation=n.router.getLocation()}}var r=i.getControl(e);var s=r.collection;var o=r.param;if(i.collection.hasOwnProperty(s)){if(i.router.options.collection===s){if(e===n.router.getLocation()){i.collection[s].refreshLocation()}else{var u=i.router.options.param;var a=i.router.options.loc;i.collection[s].beforeTryChangeLocation();i.router.options.param=o;i.router.options.loc=e;i.collection[s].changeLocation(function(n){i.router.options.param=u;i.router.options.loc=a;i.collection[s].beforeChangeLocation();i.router.options.param=o;i.router.options.loc=e;i.router.success(e,n,t)})}}else{var u=i.router.options.param;var a=i.router.options.loc;var f=i.router.options.collection;i.collection[f].beforeTryAway();i.router.options.param=o;i.router.options.loc=e;i.router.options.collection=s;i.collection[s].changeLocation(function(n){i.router.options.param=u;i.router.options.loc=a;i.router.options.collection=f;i.collection[i.router.options.collection].__destructor();i.router.options.param=o;i.router.options.loc=e;i.router.options.collection=s;i.collection[i.router.options.collection].__constructor();i.router.success(e,n,t)})}}else{if(i.options.collection404&&i.collection.hasOwnProperty(i.options.collection404)){var u=i.router.options.param;var a=i.router.options.loc;var f=i.router.options.collection;i.collection[f].beforeTryAway();i.router.options.param=o;i.router.options.loc=e;i.router.options.collection=i.options.collection404;i.collection[i.options.collection404].changeLocation(function(n){i.router.options.param=u;i.router.options.loc=a;i.router.options.collection=f;i.collection[i.router.options.collection].__destructor();i.router.options.param=o;i.router.options.loc=e;i.router.options.collection=i.options.collection404;i.collection[i.options.collection404].__constructor();i.router.success(e,n,t)})}else location.href=e}},ready:function(){if(i.collection.hasOwnProperty(i.router.options.collection))i.collection[i.router.options.collection].ready()},success:function(e,t,n){if(n)i.nav.setLoc(e,t);document.title=t}};t.router={getSegment:function(e,t){return i.router.options.param[e]||t||false},getSegments:function(){return i.router.options.param},getCollection:function(){return i.router.options.collection.toString()},getLocation:function(){return i.router.options.loc}};r.setSettings=function(){var e=document.location.pathname;var t=i.getControl(e);i.router.options.loc=e;i.router.options.collection=t.collection;i.router.options.param=t.param};t.addCollection=function(e,t){var r={__constructor:function(){},__destructor:function(){},ready:function(){},beforeTryChangeLocation:function(){},beforeChangeLocation:function(){},beforeTryAway:function(){},changeLocation:function(e){e("Pet Framework by Peteychuk aka http://www.peteychuk.com/")},refreshLocation:function(){}};i.collection[e]=n.extend(r,t)};r.getControl=function(e){var t=e;t=t.replace(new RegExp("^("+i.options.basePath+")","gi"),"");t=t.replace(/^[\/]+/i,"").replace(/[\/]+$/i,"").replace(/\.html?$/i,"");var n="index";var r=[];if(t.length>0){var s=t.split("/");n=s[0].replace(/^([a-z]+)*(.*)$/i,"$1").toLowerCase()||"index";r=s.slice(1,s.length)||[]}return{collection:n,param:r}};t.debug=function(t){if(i.options.debug===true){if(e.console&&e.console.log)console.log(t)}};t.ajax=function(e){return function(){var t;var s;var u=3e3;var a=e.type?e.type.toUpperCase():"GET";var f=e.url||false;var l=e.headers||[];var c=e.nav?true:false;var h=e.data||false;var p=e.dataType||"txt";var d=e.error||function(){};var v=e.success||function(){};var m=e.reConnect||function(){};if(!f)return false;if(e["abort"]&&i.data.lastQuery.finish===false){i.data.lastQuery.aborted=true;i.data.lastQuery.finish=true;i.data.lastQuery.abort();if(typeof i.data.lastQuery.abortOption==="function")i.data.lastQuery.abortOption()}try{t=new XMLHttpRequest}catch(g){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){t=new ActiveXObject("Microsoft.XMLHTTP")}}try{var y=false;t.onreadystatechange=function(){if(t.readyState!=4)return;if(t.status!=200){if(i.data.lastQuery.aborted!==true){if(t.status==0){y=true;if(e["reConnect"])m(false);setTimeout(function(){e["reConnect"]=true;n.ajax(e)},u)}else{if(y&&e["reConnect"])m(true);n.debug("Ajax error status: "+t.status+"; URL: "+f);d(t,t.status,f)}}return}if(y&&e["reConnect"])m(true);if(e["abort"])i.data.lastQuery.finish=true;if(p=="json")v(i.parseJSON(t.responseText));else v(t.responseText)};t.open(a,f,true);if(a=="GET"){s=null}else{l.push(["Content-type","application/x-www-form-urlencoded; charset=utf-8"]);s=h?i.ajaxUrlEncodeData(h):null}if(f.search(/^\//i)!=-1||f.search(new RegExp("^https?://"+location.host+"/","i"))===0)l.push(["X-Requested-With","XMLHttpRequest"]);if(l.length)for(var b=0,w=l.length;b<w;b++)t.setRequestHeader(l[b][0],l[b][1]);t.send(s);if(typeof e["abort"]!=="undefined"){i.data.lastQuery=t;i.data.lastQuery.finish=false;i.data.lastQuery.abortOption=e["abort"];if(c)i.data.breakRequest.breakTo=i.data.breakRequest.lastLocation;else i.data.breakRequest.breakTo=false}}catch(g){if(r.options.debug)throw g;else n.debug(g)}return t}()};r.ajaxUrlEncodeData=function(e){var t=[];var n="";for(var r in e){if(typeof e[r]==="string"||typeof e[r]==="number"||typeof e[r]==="boolean"){t.push(r+"="+encodeURIComponent(e[r]))}else if(e[r]!==null&&e[r].length){n+=(n?"&":"")+urlEncodeData2tree(r,e[r])}}return(t.length?t.join("&"):t[0])+(n?"&"+n:"")};r.ajaxUrlEncodeDataStep2=function(e,t){var n=[];for(var r in t){if(typeof t[r]==="string"||typeof t[r]==="number"||typeof t[r]==="boolean"){n.push(e+"["+r+"]="+encodeURIComponent(t[r]))}else if(t[r].length){n.push(urlEncodeData2tree(e+"["+r+"]",t[r]))}}if(n.length)return n.join("&");return""};r.parseJSON=function(t){if(typeof t!=="string"||!t||t=="")return null;t=t.replace(/^\s+/,"");t=t.replace(/\s+$/,"");if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}var n=/^[\],:{}\s]*$/;var r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var s=/(?:^|:|,)(?:\s*\[)+/g;if(n.test(t.replace(r,"@").replace(i,"]").replace(s,""))){return(new Function("return "+t))()}};t.extend=function(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e;e.superclass=t.prototype;for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e};(function(){if(history.emulate!==true){if(e.location.hash!=""){e.location.href=e.location.hash.replace("#","");return}}i.ready.init()})();return t}()})(window);
